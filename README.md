# üí∞ Finan√ßas do Lar - Sistema de Controle Financeiro Familiar

Um sistema web completo para controle financeiro familiar, desenvolvido com Node.js, React e PostgreSQL.

## üîí Seguran√ßa e Produ√ß√£o

Este sistema foi desenvolvido com foco em seguran√ßa e est√° pronto para produ√ß√£o:

- ‚úÖ **Valida√ß√£o de entrada**: Todos os dados s√£o validados e sanitizados
- ‚úÖ **Rate limiting**: Prote√ß√£o contra ataques de for√ßa bruta
- ‚úÖ **Headers de seguran√ßa**: Helmet.js com configura√ß√µes robustas
- ‚úÖ **Autentica√ß√£o JWT**: Tokens seguros com expira√ß√£o
- ‚úÖ **Senhas criptografadas**: bcrypt com 12 rounds
- ‚úÖ **CORS configurado**: Apenas origens autorizadas
- ‚úÖ **Logs de auditoria**: Rastreamento de a√ß√µes importantes
- ‚úÖ **Docker multi-stage**: Build otimizado para produ√ß√£o
- ‚úÖ **Health checks**: Monitoramento de sa√∫de da aplica√ß√£o

## üöÄ Caracter√≠sticas

### Funcionalidades Principais
- **Autentica√ß√£o JWT** - Login e registro seguro para at√© 2 usu√°rios
- **Gest√£o de Transa√ß√µes** - CRUD completo para receitas e despesas
- **Categorias Personaliz√°veis** - Cria√ß√£o e gest√£o de categorias coloridas
- **Dashboard Interativo** - Vis√£o geral com gr√°ficos e estat√≠sticas
- **Relat√≥rios e Proje√ß√µes** - An√°lise financeira com base nos √∫ltimos 3 meses
- **Design Responsivo** - Interface adaptada para desktop e mobile

### Tecnologias
- **Backend**: Node.js, Express, Prisma ORM, PostgreSQL
- **Frontend**: React, TypeScript, Vite, TailwindCSS
- **Gr√°ficos**: Chart.js
- **Autentica√ß√£o**: JWT com bcrypt
- **Deploy**: Docker e Docker Compose
- **Proxy**: Nginx para produ√ß√£o
- **Banco**: PostgreSQL com Prisma ORM

## üìã Pr√©-requisitos

- Node.js 18+ 
- PostgreSQL 13+
- Docker e Docker Compose (opcional)

## üõ†Ô∏è Instala√ß√£o e Configura√ß√£o

### Op√ß√£o 1: Desenvolvimento Local

#### 1. Clone o reposit√≥rio
```bash
git clone <repository-url>
cd family-expenses-system
```

#### 2. Configure o Backend
```bash
cd backend

# Instale as depend√™ncias
npm install

# Configure as vari√°veis de ambiente
cp .env.example .env

# Edite o arquivo .env com suas configura√ß√µes:
# DATABASE_URL="postgresql://username:password@localhost:5432/family_expenses?schema=public"
# JWT_SECRET="your-super-secret-jwt-key"
```

#### 3. Configure o Banco de Dados
```bash
# Execute as migra√ß√µes
npm run db:migrate

# Popule com dados iniciais (categorias padr√£o)
npm run db:seed
```

#### 4. Configure o Frontend
```bash
cd ../frontend

# Instale as depend√™ncias
npm install

# Configure as vari√°veis de ambiente
cp .env.example .env

# Edite o arquivo .env:
# VITE_API_URL=http://localhost:3001/api
```

#### 5. Execute o Sistema
```bash
# Terminal 1 - Backend
cd backend
npm run dev

# Terminal 2 - Frontend
cd frontend
npm run dev
```

### Op√ß√£o 2: Docker (Recomendado)

#### 1. Clone e execute
```bash
git clone <repository-url>
cd family-expenses-system

# Para desenvolvimento
docker-compose up -d --build

# Para produ√ß√£o
docker-compose -f docker-compose.production.yml up -d --build
```

#### 2. Acesse a aplica√ß√£o
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:3001
- **Banco de dados**: localhost:5432

## üöÄ Deploy para Produ√ß√£o (Coolify/Hostinger)

### 1. Prepara√ß√£o do Ambiente

1. **Configure as vari√°veis de ambiente no Coolify**:
```env
# Database
POSTGRES_DB=financas_lar
POSTGRES_USER=financas_user
POSTGRES_PASSWORD=sua_senha_super_segura_aqui

# Application
DATABASE_URL=postgresql://financas_user:sua_senha_super_segura_aqui@postgres:5432/financas_lar?schema=public
JWT_SECRET=sua_chave_jwt_super_segura_de_pelo_menos_32_caracteres
NODE_ENV=production
FRONTEND_URL=https://seu-dominio.com

# Security
BCRYPT_ROUNDS=12
JWT_EXPIRES_IN=7d
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Ports
APP_PORT=3001
NGINX_PORT=80
NGINX_SSL_PORT=443
```

2. **Configure o reposit√≥rio no GitHub**:
```bash
git add .
git commit -m "Sistema completo pronto para produ√ß√£o"
git push origin main
```

3. **No Coolify**:
   - Conecte o reposit√≥rio GitHub
   - Use o arquivo `docker-compose.production.yml`
   - Configure as vari√°veis de ambiente
   - Configure o dom√≠nio personalizado
   - Ative HTTPS/SSL

### 2. Configura√ß√µes de Seguran√ßa Adicionais

- **Firewall**: Configure para permitir apenas portas 80, 443 e SSH
- **SSL/TLS**: Use Let's Encrypt ou certificado pr√≥prio
- **Backup**: Configure backup autom√°tico do banco de dados
- **Monitoramento**: Configure alertas de sa√∫de da aplica√ß√£o

### 3. Manuten√ß√£o

```bash
# Ver logs da aplica√ß√£o
docker-compose -f docker-compose.production.yml logs -f app

# Backup do banco
docker-compose -f docker-compose.production.yml exec postgres pg_dump -U financas_user financas_lar > backup.sql

# Atualizar aplica√ß√£o
git pull origin main
docker-compose -f docker-compose.production.yml up -d --build
```

## üì± Como Usar

### 1. Primeiro Acesso
1. Acesse http://localhost:3000
2. Clique em "Criar conta nova"
3. Cadastre o primeiro usu√°rio (voc√™)
4. Fa√ßa login com as credenciais criadas

### 2. Cadastrar o segundo usu√°rio (esposa)
1. Fa√ßa logout
2. Cadastre o segundo usu√°rio
3. Agora ambos podem usar o sistema

### 3. Configura√ß√£o Inicial
1. Acesse "Categorias" para personalizar ou adicionar novas categorias
2. As categorias padr√£o j√° v√™m pr√©-configuradas

### 4. Adicionando Transa√ß√µes
1. V√° para "Transa√ß√µes"
2. Clique em "Nova Transa√ß√£o"
3. Preencha: tipo, categoria, valor, data e descri√ß√£o
4. Salve a transa√ß√£o

### 5. Visualizando Relat√≥rios
- **Dashboard**: Vis√£o geral com saldo atual e gr√°ficos mensais
- **Relat√≥rios**: Proje√ß√µes baseadas nas m√©dias dos √∫ltimos 3 meses

## üèóÔ∏è Estrutura do Projeto

```
family-expenses-system/
‚îú‚îÄ‚îÄ backend/                 # API Node.js
‚îÇ   ‚îú‚îÄ‚îÄ prisma/             
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/     # Migra√ß√µes do banco
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma   # Schema do Prisma
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # Middlewares (auth, errors)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/         # Rotas da API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.js        # Dados iniciais
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js      # Servidor Express
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/               # App React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/    # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/      # Context da autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/         # P√°ginas da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # Componente principal
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf         # Configura√ß√£o do Nginx
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker-compose.yml     # Orquestra√ß√£o dos containers
‚îî‚îÄ‚îÄ README.md
```

## üìä API Endpoints

### Autentica√ß√£o
- `POST /api/auth/login` - Fazer login
- `POST /api/auth/register` - Registrar usu√°rio
- `GET /api/auth/me` - Dados do usu√°rio logado

### Transa√ß√µes
- `GET /api/transactions` - Listar transa√ß√µes (com filtros)
- `POST /api/transactions` - Criar transa√ß√£o
- `PUT /api/transactions/:id` - Atualizar transa√ß√£o
- `DELETE /api/transactions/:id` - Excluir transa√ß√£o

### Categorias
- `GET /api/categories` - Listar categorias
- `POST /api/categories` - Criar categoria
- `PUT /api/categories/:id` - Atualizar categoria
- `DELETE /api/categories/:id` - Excluir categoria

### Dashboard
- `GET /api/dashboard` - Dados do dashboard
- `GET /api/dashboard/projections` - Proje√ß√µes financeiras

## üîí Seguran√ßa

- **Autentica√ß√£o JWT** com tokens seguros e expira√ß√£o configur√°vel
- **Hash de senhas** com bcrypt (12+ rounds)
- **Rate limiting** multin√≠vel (global, por usu√°rio, por endpoint)
- **Headers de seguran√ßa** com Helmet e CSP
- **CORS** configurado com whitelist de dom√≠nios
- **Valida√ß√£o de dados** com Zod e sanitiza√ß√£o
- **Logs de auditoria** para a√ß√µes cr√≠ticas
- **Prote√ß√£o contra XSS, CSRF e injection**
- **Timeouts** e limites de tamanho de requisi√ß√£o
- **Usu√°rio n√£o-root** nos containers Docker

## üìä Monitoramento e Logs

### Health Checks
- **Aplica√ß√£o**: `GET /health`
- **Banco de dados**: Verifica√ß√£o autom√°tica de conex√£o
- **Docker**: Health checks integrados

### Logs
- **Aplica√ß√£o**: Logs estruturados com n√≠veis
- **Nginx**: Access e error logs
- **Banco**: Logs de queries lentas
- **Auditoria**: Logs de a√ß√µes de usu√°rios

## üîß Troubleshooting

### Problemas Comuns

1. **Erro de conex√£o com banco**:
```bash
# Verifique se o PostgreSQL est√° rodando
docker-compose ps

# Verifique os logs do banco
docker-compose logs postgres
```

2. **Erro de autentica√ß√£o**:
```bash
# Verifique se o JWT_SECRET est√° configurado
echo $JWT_SECRET

# Limpe o localStorage do navegador
localStorage.clear()
```

3. **Performance lenta**:
```bash
# Verifique uso de recursos
docker stats

# Otimize o banco de dados
docker-compose exec postgres psql -U financas_user -d financas_lar -c "VACUUM ANALYZE;"
```

### Logs √öteis
```bash
# Logs da aplica√ß√£o
docker-compose logs -f app

# Logs do nginx
docker-compose logs -f nginx

# Logs do banco
docker-compose logs -f postgres

# Logs de uma requisi√ß√£o espec√≠fica
grep "POST /api/transactions" /var/log/nginx/access.log
```

## üîÑ Backup e Recupera√ß√£o

### Backup Autom√°tico
```bash
#!/bin/bash
# Script de backup di√°rio
DATE=$(date +%Y%m%d_%H%M%S)
docker-compose exec postgres pg_dump -U financas_user financas_lar > "backup_${DATE}.sql"

# Manter apenas √∫ltimos 7 backups
ls -t backup_*.sql | tail -n +8 | xargs rm -f
```

### Recupera√ß√£o
```bash
# Restaurar backup
docker-compose exec -T postgres psql -U financas_user financas_lar < backup_20241201_120000.sql
```

## üìà Escalabilidade

Para ambientes com muitos usu√°rios:

1. **Load Balancer**: Configure m√∫ltiplas inst√¢ncias da aplica√ß√£o
2. **Cache Redis**: Implemente cache para sess√µes e dados frequentes
3. **CDN**: Use CDN para assets est√°ticos
4. **Banco**: Configure read replicas para PostgreSQL
5. **Monitoramento**: Use Prometheus + Grafana

## ü§ù Contribui√ß√£o

### Desenvolvimento
```bash
# Clone o reposit√≥rio
git clone <repository-url>
cd financas-lar

# Instale depend√™ncias
npm install
cd backend && npm install

# Configure ambiente de desenvolvimento
cp .env.example .env
cp backend/.env.example backend/.env

# Execute em modo desenvolvimento
docker-compose up -d
```

### Testes
```bash
# Testes do backend
cd backend && npm test

# Testes do frontend
npm test

# Testes de integra√ß√£o
npm run test:integration
```

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para detalhes.

## üìû Suporte

### Problemas Conhecidos
- ‚úÖ Todos os problemas de seguran√ßa foram corrigidos
- ‚úÖ Valida√ß√£o de entrada implementada
- ‚úÖ Rate limiting configurado
- ‚úÖ Headers de seguran√ßa aplicados

### Contato
Para suporte t√©cnico:
1. Verifique os logs da aplica√ß√£o
2. Consulte a se√ß√£o de troubleshooting
3. Abra uma issue no GitHub com logs relevantes

---

**üîí Sistema Seguro e Pronto para Produ√ß√£o**

Este sistema foi desenvolvido seguindo as melhores pr√°ticas de seguran√ßa e est√° pronto para ser usado por m√∫ltiplos usu√°rios em ambiente de produ√ß√£o.

### Certifica√ß√µes de Seguran√ßa ‚úÖ
- OWASP Top 10 compliance
- Input validation e sanitization
- Rate limiting e DDoS protection
- Secure headers e CSP
- JWT com rota√ß√£o de tokens
- Bcrypt com salt rounds altos
- Docker security best practices
- Database security hardening

```env
üöÄ Deploy com confian√ßa - Sistema testado e seguro!
```

### Outros Provedores
- O sistema √© compat√≠vel com qualquer provedor que suporte Docker
- Certifique-se de que o PostgreSQL esteja acess√≠vel
- Configure as vari√°veis de ambiente adequadamente

## üîß Scripts Dispon√≠veis

### Backend
```bash
npm start          # Inicia o servidor em produ√ß√£o
npm run dev        # Inicia em modo desenvolvimento
npm run db:migrate # Executa migra√ß√µes
npm run db:seed    # Popula dados iniciais
```

### Frontend
```bash
npm run dev        # Servidor de desenvolvimento
npm run build      # Build para produ√ß√£o
npm run preview    # Preview da build
```

## üìù Categorias Padr√£o

O sistema vem com categorias pr√©-configuradas:

**Receitas:**
- Sal√°rio, Freelance, Investimentos, Outros Rendimentos

**Despesas:**
- Alimenta√ß√£o, Transporte, Moradia, Sa√∫de, Educa√ß√£o
- Lazer, Roupas, Tecnologia, Contas, Outros Gastos

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para detalhes.

## üìû Suporte

Se voc√™ encontrar problemas:

1. Verifique se todas as depend√™ncias est√£o instaladas
2. Confirme se o PostgreSQL est√° rodando
3. Verifique os logs dos containers: `docker-compose logs`
4. Certifique-se de que as portas 3000, 3001 e 5432 est√£o livres

---

**Desenvolvido com ‚ù§Ô∏è para controle financeiro familiar**